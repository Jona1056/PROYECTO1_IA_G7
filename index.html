<!-- Program -->
<script src="./tauprolog.js"></script>
<script type="text/prolog" id="doge.pl">
    :- use_module(library(dom)).
    
    % Define paredes locations (you can specify positions as needed)
    paredes(0, 50).
    paredes(50, 50).
    paredes(100, 50).
    paredes(0, 100).
    paredes(0, 150).
    paredes(0, 200).
    paredes(0, 250).
    paredes(0, 300).
    paredes(0, 350).
    paredes(0, 400).
    paredes(50,400).
    paredes(100, 400).
    paredes(150, 400).
    paredes(200, 400).
    paredes(250, 400).
    paredes(300, 400).
    paredes(350, 400).
    paredes(400, 400).
    paredes(350, 350).
    paredes(350, 300).
    paredes(350, 250).
    paredes(300, 250).
    paredes(300, 200).
    paredes(300, 150).
    paredes(300, 150).
    paredes(300, 100).
    paredes(300, 50).
    paredes(50, 0).
    paredes(0, 0).
    paredes(100, 0).
    paredes(150, 0).
    paredes(200, 0).
    paredes(250, 0).
    paredes(300, 0).
    paredes(350, 0).
    paredes(400, 0).
    paredes(100, 150).
    paredes(50, 150).
    paredes(100, 200).
    paredes(100, 250).
    paredes(150, 200).

    estrella(150, 100).


    % Check if a position collides with any paredes
    colision_paredes(X, Y) :-
        paredes(ParedesX, ParedesY),
        X >= ParedesX, X =< ParedesX + 40,  % Adjust size as needed
        Y >= ParedesY, Y =< ParedesY + 40.  % Adjust size as needed

        % move/3
        % Mover el Doge si no colisiona con una caja
        move(Doge, Axis, Incr) :-
            get_by_id(board, Board),
            style(Doge, Axis, px(X0)),
            X1 is X0 + Incr,
            style(Doge, top, px(Y)), style(Doge, left, px(X)),  % Obtener la posición actual
            (Axis = top -> (\+ colision_paredes(X, X1)) ; (\+ colision_paredes(X1, Y))),  % Verificar colisión
            X1 >= -32,
            (Axis = top -> X1 =< 500 ; X1 =< 640),
            style(Doge, Axis, px(X1)).

    % anim/2
    % Change animation of the doge
    anim(Doge, Dir) :-
        atom_concat('/img', Dir, Src1),
        atom_concat(Src1, '.png', Src),
        style(Doge, backgroundImage, url(Src)).
    
    % clear_control/0
    % Remove the focus class of any control
    clear_controls :-
        findall(X, (get_by_class(control, X), remove_class(X, focus)), _).
    
    % remark_control/1
    % Remark the pressed control
    remark_control(Key) :-
        clear_controls,
        atom_concat('control-', Key, Id),
        get_by_id(Id, Control),
        add_class(Control, focus).
    
        % Acción para moverse hacia arriba
        action(Doge, w) :-
            anim(Doge, up),
            move(Doge, top, -50).  % Llama a move que manejará el movimiento y colisiones
        
        % Acción para moverse hacia abajo
        action(Doge, s) :-
            anim(Doge, down),
            move(Doge, top, 50).
        
        % Acción para moverse a la izquierda
        action(Doge, a) :-
            anim(Doge, left),
            move(Doge, left, -50).
        
        % Acción para moverse a la derecha
        action(Doge, d) :-
            anim(Doge, right),
            move(Doge, left, 50).
        
  
    
    % init/0
    % Initialize the game
    init :-
        get_by_id(doge, Doge),
        get_by_tag(body, Body),
        bind(Body, keyup, _, clear_controls),
        bind(Body, keydown, Event, (
            event_property(Event, key, Key),
            remark_control(Key),
            action(Doge, Key),
            prevent_default(Event)
        )).
</script>

<!-- Styles -->
<style type="text/css">
    #board {
        background: rgb(225, 231, 227) url("/content/examples/resources/my-little-doge/grass.png") center center repeat;
        width: 500px;
        height: 550px;
        border: 10px solid #563101;
        margin-left:150px;
        margin-bottom: 60px;
        position: relative;
    }

    #doge {
        background: transparent url("/img/mario.png") center center no-repeat;
        position: absolute;
        top: 100px;
        left: 100px;
        width: 128px;
        height: 128px;
        margin-bottom: -86px;
        z-index: 90;
        transform: scale(0.4);
        /* Scale down to 50% */
    }

    .poop {
        background: transparent url("/img/mario.png") center center no-repeat;
        position: absolute;
        width: 20px;
        height: 20px;
        margin-bottom: -20px;
        z-index: 80;
        transform: scale(0.7);
        /* Scale down to 50% */
    }

    #controls {
        position: absolute;
        top: 30px;
        left: 650px;
        z-index: 99;
    }

    .control {
        background-color: #fafafa;
        display: inline-block;
        color: #444444;
        font-weight: bold;
        font-size: 20px;
        font-family: monospace, arial;
        text-align: center;
        padding: 5px 0px;
        border-radius: 3px;
        box-shadow: 0px 5px 0px #dfdfdf;
        width: 40px;
        margin-bottom: 10px;
        opacity: 0.9;
    }

    .control.focus {
        background-color: #eda240;
        color: #ffffff;
        box-shadow: 0px 5px 0px #d0831e;
        opacity: 1;
    }

    #control-w {
        display: block;
        position: relative;
        left: 45px;
    }

    #control-p {
        display: block;
        width: 130px;
    }

    .paredes {
        background: transparent url("/img/bloque2.png") center center no-repeat;
        position: absolute;
        top: 157px;
        left: 357px;
        width: 128px;
        height: 128px;
        margin-bottom: -86px;
        z-index: 90;
        transform: scale(0.4);
        /* Scale down to 50% */
    }

    .estrellas{
        background: transparent url("/img/estrella.png") center center no-repeat;
        position: absolute;
        top: 157px;
        left: 357px;
        width: 128px;
        height: 128px;
        margin-bottom: -86px;
        z-index: 89;
        transform: scale(0.4);
        /* Scale down to 50% */
    }

    #Paredes1 {
        top: 50px;
        left: 0px;
    }

    #Paredes2 {
        top: 100px;
        left: 0px;
    }

    #Paredes3 {
        top: 0px;
        left: 50px;
    }
    #Paredes4 {
        top: 0px;
        left: 0px;
    }
    #Paredes5 {
        top: 0px;
        left: 100px;
    }
    #Paredes6 {
        top: 0px;
        left: 150px;
    }
    #Paredes7 {
        top: 0px;
        left: 200px;
    }
    #Paredes8 {
        top: 0px;
        left: 250px;
    }
    #Paredes9 {
        top: 0px;
        left: 300px;
    }
    #Paredes10 {
        top: 0px;
        left: 350px;
    }

    #Paredes12 {
        top: 50px;
        left: 50px;
    }
    #Paredes13{
        top: 50px;
        left: 100px;
    }
    #Paredes14{
        top: 150px;
        left: 0px;
    }
    #Paredes15{
        top: 200px;
        left: 0px;
    }
    #Paredes16{
        top: 250px;
        left: 0px;
    }
    #Paredes17{
        top: 300px;
        left: 0px;
    }
    #Paredes18{
        top: 350px;
        left: 0px;
    }
    #Paredes19{
        top: 400px;
        left: 0px;
    }
    #Paredes20{
        top: 400px;
        left: 50px;
    }
    #Paredes21{
        top: 400px;
        left:100px;
    }
    #Paredes22{
        top: 400px;
        left:150px;
    }
    #Paredes23{
        top: 400px;
        left:200px;
    }
    #Paredes24{
        top: 400px;
        left:250px;
    }
    #Paredes25{
        top: 400px;
        left:300px;
    }
    #Paredes26{
        top: 400px;
        left:350px;
    }
    #Paredes27{
        top: 400px;
        left:400px;
    }
    #Paredes28{
        top: 350px;
        left:350px;
    }
    #Paredes29{
        top: 250px;
        left:350px;
    }
    #Paredes30{
        top: 300px;
        left:350px;
    }
    #Paredes31{
        top: 250px;
        left:300px;
    }
    #Paredes32{
        top: 200px;
        left:300px;
    }
    #Paredes33{
        top: 150px;
        left:300px;
    }
    #Paredes34{
        top: 100px;
        left:300px;
    }
    #Paredes35{
        top: 50px;
        left:300px;
    }
    #Paredes36{
        top: 150px;
        left:100px;
    }
    #Paredes37{
        top: 150px;
        left:50px;
    }
    #Paredes38{
        top: 200px;
        left:100px;
    }
    #Paredes39{
        top: 250px;
        left:100px;
    }
    #Paredes40{
        top: 200px;
        left:150px;
    }

    #estrella1{
        top: 100px;
        left:150px;
    }



</style>

<!-- Board -->
<div id="board">
    <div id="doge"></div>
    <div id="controls">
        <div class="control" id="control-w">w</div>
        <div class="control" id="control-a">a</div>
        <div class="control" id="control-s">s</div>
        <div class="control" id="control-d">d</div>
        <div class="control" id="control-p">p (poop)</div>
    </div>
    <!-- Paredeses -->
    <div class="paredes" id="Paredes1"></div>
    <div class="paredes" id="Paredes2"></div>
    <div class="paredes" id="Paredes3"></div>
    <div class="paredes" id="Paredes4"></div>
    <div class="paredes" id="Paredes5"></div>
    <div class="paredes" id="Paredes6"></div>
    <div class="paredes" id="Paredes7"></div>
    <div class="paredes" id="Paredes8"></div>
    <div class="paredes" id="Paredes9"></div>


    <div class="paredes" id="Paredes12"></div>
    <div class="paredes" id="Paredes13"></div>
    <div class="paredes" id="Paredes14"></div>
    <div class="paredes" id="Paredes15"></div>
    <div class="paredes" id="Paredes16"></div>
    <div class="paredes" id="Paredes17"></div>
    <div class="paredes" id="Paredes18"></div>
    <div class="paredes" id="Paredes19"></div>
    <div class="paredes" id="Paredes20"></div>
    <div class="paredes" id="Paredes21"></div>
    <div class="paredes" id="Paredes22"></div>
    <div class="paredes" id="Paredes23"></div>
    <div class="paredes" id="Paredes24"></div>
    <div class="paredes" id="Paredes25"></div>
    <div class="paredes" id="Paredes26"></div>

    <div class="paredes" id="Paredes28"></div>
    <div class="paredes" id="Paredes29"></div>
    <div class="paredes" id="Paredes30"></div>
    <div class="paredes" id="Paredes31"></div>
    <div class="paredes" id="Paredes32"></div>
    <div class="paredes" id="Paredes33"></div>
    <div class="paredes" id="Paredes34"></div>
    <div class="paredes" id="Paredes35"></div>
    <div class="paredes" id="Paredes36"></div>
    <div class="paredes" id="Paredes37"></div>
    <div class="paredes" id="Paredes38"></div>
    <div class="paredes" id="Paredes39"></div>
    <div class="paredes" id="Paredes40"></div>


    <!-- Estrealla -->
    <div class="estrellas" id="estrella1"></div>
</div>


<script type="text/javascript">
    // Create session
    var session = pl.create(1000);
    // Consult program
    session.consult("doge.pl");
    // Query goal
    session.query("init.");
    // Find answers
    session.answer(console.log);
</script>